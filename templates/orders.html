<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin ¬∑ Orders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; display:flex; background:#0d1117; color:#e6edf3; }
    aside { width:200px; background:#161b22; padding:20px; }
    aside h2 { font-size:18px; margin-bottom:20px; }
    aside a {
      display:block; padding:10px; margin:8px 0;
      color:#c9d1d9; text-decoration:none; border-radius:8px;
    }
    aside a:hover { background:#21262d; }
    main { flex:1; padding:20px; }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    h1 { margin:0; font-size:22px; }
a.btn, button.btn {
    background-color: #ffffffa7;
    color: #000000;
    padding: 0;                 /* remove padding control */
    border-radius: 3px;
    border: 1px solid #007bff;
    cursor: pointer;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    font-weight: 600;
    font-size: 12px;

    width: 80px;                /* fixed width */
    height: 28px;               /* fixed height */
    line-height: 28px;          /* vertically center text */
    text-align: center;         /* horizontally center text */
    white-space: nowrap;        /* prevent text wrapping */
}




    table { width:100%; border-collapse:collapse; background:#161b22; border-radius:10px; overflow:hidden; }
    th,td { padding:12px; font-size:14px; border-bottom:1px solid #30363d; vertical-align:top; }
    th { background:#21262d; text-align:left; }
    tr:hover td { background:#1c2128; }
    .pill { padding:6px 10px; border-radius:30px; font-size:12px; display:inline-block; }
    .status-pending { background:#3d2e00; color:#ffd580; }
    .status-paid { background:#003d1e; color:#6affc2; }
    .status-done { background:#002d3d; color:#6abaff; }
    .status-ppv { background:#392313; color:#ffc29b; }
    form { display:inline; }
    .details-box { font-size:13px; line-height:1.4; }
    .details-box b { color:#9ae6b4; }
  </style>
</head>
<body>
  <aside>
    <h2>WELCOME</h2>
    <h2>‚öôÔ∏è Admin</h2>
    <a href="{{ url_for('orders') }}">üìã Orders</a>
    <a href="{{ url_for('export_excel') }}">‚¨áÔ∏è Download</a>
    <a href="{{ url_for('logout') }}">üö™ Logout</a>
  </aside>
  <main>
    <header>
      <h1>Bookings Dashboard</h1>
    </header>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Type</th>
          <th>Details</th>
          <th>Customer</th>
          <th>Phone</th>
          <th>Message</th>
          <th>Email</th>
          <th>Payment</th>
          <th>Status</th>
          <th>Location</th>   <!-- ‚úÖ changed -->
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.id }}</td>
          <td>
            {% if r.booking_type == "simple" %} üìù Simple
            {% elif r.booking_type == "test" %} üß™ Test
            {% elif r.booking_type == "checkout" %} üõí Checkout
            {% else %}  {{ r.booking_type }}
            {% endif %}
          </td>
          <td class="details-box">
            {% if r.booking_type == "simple" %}
              <b>Message:</b> {{ r.test_name or "N/A" }}
            {% elif r.booking_type == "test" %}
              <b>Test:</b> {{ r.test_name }}<br>
              <b>Address:</b> {{ r.address or "‚Äî" }}
            {% elif r.booking_type == "checkout" %}
              <b>Items:</b> {{ r.items_json }}<br>
              <b>Total:</b> ‚Çπ{{ r.total_amount }}
            {% else %}
              {{ r.test_name or r.items_json }}
            {% endif %}
          </td>
          <td>{{ r.customer_name }}</td>
          <td>{{ r.phone }}</td>
          <td>{{ r.message or '‚Äî' }}</td>
          <td>{{ r.email or "‚Äî" }}</td>
          <td>{{ r.payment_mode or "‚Äî" }}</td>
          <td>
            {% if r.status == 'Paid' %}
              <span class="pill status-paid">Paid</span>
            {% elif r.status == 'Done' %}
              <span class="pill status-done">Done</span>
            {% elif r.status == 'Payment Pending Verification' %}
              <span class="pill status-ppv">Pending Verification</span>
            {% else %}
              <span class="pill status-pending">Pending</span>
            {% endif %}
          </td>
          <td>{{ r.location or "‚Äî" }}</td>   <!-- ‚úÖ Location instead of created_at -->
          <td>
            {% set can_confirm = (
                  r.status != 'Done' and 
                  (
                    r.status == 'Pending' or
                    (r.booking_type == 'checkout' and r.payment_mode|lower == 'upi' and r.status == 'Payment Pending Verification') or
                    (r.booking_type == 'manual')
                  )
            ) %}


            {% if can_confirm %}
            <form method="post" action="{{ url_for('confirm_booking', booking_id=r.id) }}" onsubmit="return confirm('Confirm this booking?');">
              <button class="btn">
                {{ 'Confirm Payment ‚úÖ' if r.booking_type == 'checkout' and r.payment_mode == 'UPI' else 'Mark Done ‚úÖ' }}
              </button>

            </form>
            {% else %} ‚Äî {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </main>
</body>
</html>
